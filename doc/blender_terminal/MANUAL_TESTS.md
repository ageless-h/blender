# MANUAL_TESTS

## M1 - Python Console 体验增强

### 1. 多行粘贴：默认安全（不自动执行）

- **准备**
  - 打开 Blender -> Console。
  - 确保当前语言为 Python（Header -> Console -> Languages -> Python）。

- **步骤**
  - 复制以下内容到系统剪贴板（至少 3 行）：
    - `print("A")`
    - `print("B")`
    - `print("C")`
  - 在 Console 输入行按 `Ctrl+V`。

- **预期**
  - 不会触发多次执行。
  - 输入行会变为单行（多行被合并为一行）。
  - 仅在你手动按 `Enter`（执行）后才会执行。

### 2. 多行粘贴：显式执行（带确认）

- **步骤**
  - 复制与上面相同的 3 行文本到系统剪贴板。
  - 在 Console 输入行按 `Ctrl+Shift+V`。

- **预期**
  - 弹出确认对话框（提示将执行的次数）。
  - 点击取消：不应执行任何命令。
  - 点击确认：应按“逐行执行”的策略执行（行为与旧版本一致：执行发生在插入下一行之前）。

### 3. 大文本粘贴：不会冻结 UI

- **步骤**
  - 生成 50 行文本（例如 `print(0)` 到 `print(49)`），复制到剪贴板。
  - 在 Console 输入行按 `Ctrl+V`。

- **预期**
  - UI 不冻结。
  - 不发生意外执行。

### 4. 历史搜索（Ctrl+R）

- **准备**
  - 在 Console 中依次执行至少 10 条不同命令（例如 `a=1`、`b=2`、`print(a)` 等）。

- **步骤**
  - 按 `Ctrl+R` 进入历史搜索。
  - 输入关键词（例如 `print`）。
  - 重复按 `Ctrl+R` 在匹配项之间循环。
  - 按 `Enter` 选中，将结果回填到当前输入行。
  - 再次按 `Ctrl+R`，输入关键词后按 `Esc` 取消。

- **预期**
  - 进入搜索后，Header 显示 `History Search: ...`。
  - 输入关键词能匹配到预期命令。
  - 循环切换匹配项时不崩溃、不乱码。
  - `Enter` 后当前输入行被替换为匹配项，并且光标在末尾。
  - `Esc` 后恢复进入搜索前的输入行内容。

### 5. 编辑快捷键（回归）

- **步骤**
  - 输入：`foo_bar baz.qux`
  - 验证：
    - `Home/End`
    - `Ctrl+Left/Right`
    - `Ctrl+Backspace` / `Ctrl+Delete`

- **预期**
  - 光标移动/按词删除行为合理且稳定（与 Text Editor 接近）。

### 6. 输出体验：长输出不卡顿（最小验证）

- **步骤**
  - 在 Console 输入并执行：
    - `for i in range(5000): print(i)`

- **预期**
  - 输出追加过程中 UI 仍可响应（窗口可拖动、鼠标滚轮滚动不至于长期卡死）。
  - 输出完成后：
    - 可以正常滚动浏览输出。
    - 选择/复制一段输出不崩溃、不乱码。

### 7. 输出分组（最小能力）：Copy Last as Script

- **准备**
  - 确保 Console 语言为 Python。

- **步骤**
  - 执行一条会产生输出的命令，例如：
    - `print("hello")`
  - 从菜单执行：
    - `Console -> Copy Last as Script`
  - 把剪贴板内容粘贴到文本编辑器查看。

- **预期**
  - 剪贴板包含一个可读的脚本片段：
    - INPUT 行会被转成可执行的 Python 行（去掉 `>>> ` / `... ` prompt）。
    - OUTPUT 行以 `#~ ` 前缀注释。
    - ERROR 行以 `#! ` 前缀注释。

### 8. Windows 兼容性回归：输入法/剪贴板

#### 8.1 输入法（TEXTINPUT）

- **步骤**
  - Windows 下切换到中文输入法（候选框出现）。
  - 在 Console 输入行中：
    - 输入英文、数字、下划线、点号（例如 `foo_bar baz.qux`）。
    - 输入中文字符（例如 `"中文"` 作为字符串的一部分）。
    - 反复使用 `Backspace` 删除。

- **预期**
  - 候选上屏不会导致控制台输入行乱码。
  - `Ctrl+R` 历史搜索的输入与删除行为正常。

#### 8.2 剪贴板（CRLF/跨应用）

- **步骤**
  - 从外部应用（例如记事本/浏览器）复制多行文本（Windows 常见为 CRLF）。
  - 在 Console 输入行使用：
    - `Ctrl+V`（安全粘贴）
    - `Ctrl+Shift+V`（粘贴并执行，带确认）

- **预期**
  - 不出现 `\r` 字符残留导致的异常。
  - 行数统计与确认文案合理。

#### 8.3 性能基线（记录用）

- **步骤**
  - 执行：`for i in range(20000): print(i)`。
  - 记录：
    - 从按下回车到输出完成的耗时（可用秒表）。
    - 输出完成后滚动/框选复制时是否有明显卡顿。

- **预期**
  - 能完成输出并保持可用性（不要求无卡顿，但应避免长时间无响应）。
