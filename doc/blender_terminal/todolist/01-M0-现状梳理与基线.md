# M0 - 现状梳理与基线

对应：`PLAN.md` -> `### M0 - 现状梳理与基线`

## 阶段目标

- 把 Console 的“事实实现路径”梳理清楚（输入链路、数据结构、绘制链路、Python 后端路由）。
- 建立一份**可重复执行**的手工测试清单，为后续 M1~M4 提供回归基线。

## 输入/前置条件

- 能打开当前仓库并定位 `source/...` 与 `scripts/...` 文件。
-（可选）能本地编译运行 Blender，用于验证手工测试。

## 交付物（阶段级）

- 痛点列表与优先级文档
- 手工测试清单文档
- 一份最小原型需求（M1）

## To-Do

### 1. 建立“Console 架构图”

- [ ] **任务说明**：从 `Keymap -> Operator -> Python module -> SpaceConsole 数据结构 -> 绘制链路` 画出一张架构图。

#### 交付物

- `doc/blender_terminal/` 下新增一张架构图（Markdown 图/mermaid/图片均可）。

#### 交付检查

- 架构图至少包含：
  - Keymap 入口（`km_console`）
  - 关键 Operator（insert/execute/paste/history/autocomplete 等）
  - `SpaceConsole` 的关键字段（history/scrollback/sel_* 等）
  - 绘制入口（TextView/console_draw）
  - Python 路由入口（`scripts/startup/bl_operators/console.py`）

#### 测试/验收

- **文档验收**：阅读架构图即可回答：
  - 当前编辑行在哪里（数据结构/字段）
  - 按键输入是如何变成对 `ConsoleLine` 的修改
  - `execute` 时如何把输出写回 scrollback

---

### 2. 列出关键文件与职责（形成一页索引）

- [ ] **任务说明**：把关键文件整理成索引页，明确“这个文件负责什么”。

#### 交付物

- `doc/blender_terminal/` 下新增 `INDEX.md`（或等价索引文档）。

#### 交付检查

- 索引页至少覆盖：
  - `source/blender/editors/space_console/*`
  - `source/blender/makesdna/*` 中与 `SpaceConsole` 相关部分
  - `source/blender/makesrna/*` 中与 Console 暴露相关部分
  - `scripts/startup/bl_operators/console.py`
  - `scripts/modules/_console_python.py`
  - `scripts/modules/_console_shell.py`
  - `scripts/startup/bl_ui/space_console.py`

#### 测试/验收

- **人工抽查**：随机挑选 3 个文件，索引描述与实际内容一致。

---

### 3. 梳理当前交互能力清单

- [ ] **任务说明**：列出现有能力与行为规则。
  - 光标移动/选择
  - 历史上下
  - 复制/剪切/粘贴
  - 补全/调用提示
  - 缩放字体

#### 交付物

- 一份“能力清单”文档（建议用表格：能力/快捷键/行为/已知问题）。

#### 交付检查

- 每一项能力至少包含：
  - 入口（快捷键 or 菜单 or Operator）
  - 预期行为
  - 已知限制（例如多行/大文本/输入法）

#### 测试/验收（手工）

- 在 Blender Console 中逐项验证：
  - 光标移动与选择：不会越界、选择范围正确
  - 历史上下：历史能正确切换，且不会污染 scrollback
  - 复制/粘贴：粘贴一行不会自动执行（如当前行为会执行，需记录）
  - 自动补全：能触发并不会导致崩溃
  - 字体缩放：能变化且不影响输入定位

---

### 4. 记录痛点清单并分级

- [ ] **任务说明**：把痛点按体验/功能/质量/安全分类，并给出优先级（P0/P1/P2）。

#### 交付物

- `doc/blender_terminal/` 下新增 `PAIN_POINTS.md`（或等价）。

#### 交付检查

- 每个痛点至少包含：
  - 复现步骤
  - 期望行为 vs 现状行为
  - 影响范围
  - 风险等级

#### 测试/验收

- **复现性检查**：随机抽查 5 个痛点，按照文档步骤可复现。

---

### 5. 建立手工测试清单（可复现与验收）

- [ ] **任务说明**：把后续阶段需要的关键回归场景沉淀成清单。

#### 交付物

- `doc/blender_terminal/` 下新增 `MANUAL_TESTS.md`（或等价）。

#### 交付检查

- 测试用例至少覆盖：
  - 单行输入/执行
  - 多行粘贴（含“是否会触发多次执行”）
  - 长输出（性能/滚动/选择）
  - 历史操作（上/下/搜索）
  - 自动补全
  - 复制/粘贴跨应用（外部编辑器 <-> Blender）

#### 测试/验收

- **可执行性**：每个用例都有明确步骤与预期结果。
- **可回归性**：同一用例在多次运行中结果一致。
